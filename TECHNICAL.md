# راهنمای فنی - فاز اول

## معماری برنامه

### 1. کلاس NumberCard

کلاس `NumberCard` از `Entity` در Ursina ارث‌بری می‌کند و یک کارت بازی را نمایش می‌دهد.

**ویژگی‌های کلیدی:**
- `number`: عدد روی کارت
- `is_flipped`: وضعیت چرخش کارت (رو یا پشت)
- `is_matched`: آیا کارت جفت شده است؟
- `number_text`: متن عدد (مخفی در حالت اولیه)
- `back_text`: علامت سوال روی پشت کارت

**متدهای مهم:**

#### `__init__(self, number, position)`
- ایجاد کارت با عدد و موقعیت مشخص
- تنظیم رنگ آبی (azure) برای پشت کارت
- ایجاد دو Text entity برای نمایش عدد و علامت سوال

#### `input(self, key)`
- مدیریت رویداد کلیک موس
- فقط زمانی که کارت hover شده و کلیک چپ زده شود
- فقط اگر کارت رو نشده و جفت نشده باشد

#### `flip(self)`
- انیمیشن چرخش کارت با استفاده از `animate_scale_x`
- مدت زمان: 0.15 ثانیه برای هر نیمه چرخش
- استفاده از curve.in_out_expo برای حرکت نرم

**فلوی انیمیشن:**
```
کلیک → scale_x به 0 → تعویض متن → scale_x به 1.5
```

#### `mark_as_matched(self)`
- تغییر رنگ به سبز
- کوچک شدن تا ناپدید شدن (animate_scale to 0)
- غیرفعال کردن کارت بعد از 0.3 ثانیه

---

### 2. کلاس GameManager

کلاس `GameManager` مسئول مدیریت کل بازی است.

**ویژگی‌های کلیدی:**
- `num_pairs`: تعداد جفت‌های کارت
- `cards`: لیست تمام کارت‌های بازی
- `flipped_cards`: کارت‌های باز شده (برای فازهای بعدی)

**متدهای مهم:**

#### `__init__(self, num_pairs)`
- ایجاد بازی با تعداد جفت مشخص
- فراخوانی `create_cards()` برای ایجاد کارت‌ها

#### `create_cards(self)`
این متد کارت‌ها را به صورت هوشمند می‌چیند:

1. **ایجاد اعداد:**
   ```python
   numbers = list(range(1, num_pairs + 1)) * 2  # هر عدد دو بار
   shuffle(numbers)  # مخلوط کردن
   ```

2. **محاسبه Grid:**
   - برای 12 کارت: 4 ستون
   - برای 20 کارت: 5 ستون
   - برای بیشتر: 6 ستون
   - تعداد ردیف: ceil(total_cards / cols)

3. **مرکزیت:**
   ```python
   start_x = -(cols - 1) * spacing_x / 2
   start_y = (rows - 1) * spacing_y / 2
   ```

4. **چیدمان:**
   - حلقه روی ردیف‌ها و ستون‌ها
   - محاسبه موقعیت x, y برای هر کارت
   - ایجاد NumberCard با موقعیت محاسبه شده

---

### 3. تنظیمات Ursina

#### `setup_window()`
- عنوان پنجره: "بازی حافظه کودکان"
- غیرفعال کردن borderless و fullscreen
- مخفی کردن دکمه خروج و شمارنده FPS
- تنظیم دوربین orthographic با FOV=20

#### `main()`
- ایجاد app Ursina
- فراخوانی setup_window()
- تنظیم رنگ پس‌زمینه (خاکستری تیره)
- ایجاد GameManager با 6 جفت (12 کارت)
- اجرای حلقه اصلی با app.run()

---

## جریان اجرا

```
1. main() فراخوانی می‌شود
2. Ursina app ایجاد می‌شود
3. setup_window() تنظیمات را اعمال می‌کند
4. GameManager(6) ایجاد می‌شود
   ├─ create_cards() فراخوانی می‌شود
   ├─ 12 کارت با اعداد 1-6 (دوبار هر کدام) ایجاد می‌شوند
   └─ کارت‌ها در Grid 4x3 چیده می‌شوند
5. app.run() حلقه بازی را شروع می‌کند
6. کاربر می‌تواند روی کارت‌ها کلیک کند
   ├─ input() متد کارت فراخوانی می‌شود
   ├─ flip() انیمیشن چرخش را اجرا می‌کند
   └─ عدد نمایش داده می‌شود
```

---

## قابلیت‌های پیاده‌سازی شده ✓

### ۱. موتور Ursina راه‌اندازی شده
- ✓ تنظیمات پنجره
- ✓ تنظیمات دوربین
- ✓ رنگ پس‌زمینه

### ۲. کلاس NumberCard
- ✓ نمایش کارت با رنگ و استایل
- ✓ انیمیشن چرخش نرم
- ✓ نمایش عدد پس از چرخش
- ✓ علامت سوال روی پشت
- ✓ مدیریت کلیک

### ۳. کلاس GameManager
- ✓ ایجاد کارت‌ها
- ✓ چیدمان Grid منظم
- ✓ قابلیت تغییر تعداد کارت‌ها (پارامتر num_pairs)

---

## نکات فنی مهم

### انیمیشن‌های نرم
استفاده از `curve.in_out_expo` برای حرکت‌های طبیعی:
```python
self.animate_scale_x(0, duration=0.15, curve=curve.in_out_expo)
```

### داینامیک بودن
تعداد کارت‌ها را می‌توان به راحتی تغییر داد:
```python
game_manager = GameManager(num_pairs=8)  # 16 کارت
```

### ساختار قابل توسعه
کد به صورتی نوشته شده که فازهای بعدی را پشتیبانی می‌کند:
- `is_matched` برای سیستم جفت‌یابی
- `flipped_cards` در GameManager برای مدیریت نوبت
- `mark_as_matched()` برای نشان دادن جفت‌های پیدا شده
